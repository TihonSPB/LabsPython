# -*- coding: utf-8 -*-
# Обработчик ошибок

from flask import render_template  # Импортируем функцию для рендеринга шаблонов
from app import app, db            # Импортируем приложение и базу данных

# Обработчик ошибки 404 (Страница не найдена)
@app.errorhandler(404)
def not_found_error(error):
    """
    Вызывается автоматически, когда пользователь пытается перейти 
    на несуществующую страницу.
    """
    # Возвращаем кастомный шаблон 404.html с кодом состояния 404
    return render_template('404.html'), 404

# Обработчик ошибки 500 (Внутренняя ошибка сервера)
@app.errorhandler(500)
def internal_error(error):
    """
    Вызывается при непредвиденных ошибках в приложении 
    (например, ошибки в коде, проблемы с БД).
    """
    # Откатываем текущую транзакцию базы данных
    # Это важно, чтобы не оставить БД в неконсистентном состоянии
    db.session.rollback()
    
    # Возвращаем кастомный шаблон 500.html с кодом состояния 500
    return render_template('500.html'), 500

